<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BFF Chat Pro üíñ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* --- THEME VARIABLES --- */
        :root { 
            --primary: #ffb7b2; 
            --secondary: #ffdac1; 
            --accent: #ff9aa2; 
            --bg: #fff0f5; 
            --text: #6e5773; 
            --white: #ffffff; 
            --blue-tick: #34b7f1; 
            --grey-tick: #aaa; 
        }

        /* GLOBAL RESET */
        * { box-sizing: border-box; }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: var(--bg); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            height: 100dvh; /* For mobile browsers */
            color: var(--text); 
            overflow: hidden; /* Prevent background scrolling */
        }

        /* --- APP CONTAINER (DESKTOP LOOK) --- */
        .app-container { 
            width: 100%; 
            max-width: 400px; 
            height: 90vh; 
            background: var(--white); 
            border-radius: 25px; 
            box-shadow: 0 10px 25px rgba(255, 183, 178, 0.5); 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
        }

        /* --- MOBILE RESPONSIVENESS (MAGIC HAPPENS HERE) --- */
        @media (max-width: 480px) {
            body {
                background-color: var(--white); /* Match app bg */
            }
            .app-container {
                max-width: 100%;
                height: 100%; /* Full screen height */
                border-radius: 0; /* No round corners on phone */
                box-shadow: none; /* No shadow on phone */
            }
        }

        /* --- LOGIN SCREEN --- */
        #login-screen { 
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: linear-gradient(135deg, var(--primary), var(--secondary)); 
            z-index: 100; 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            transition: top 0.5s ease-in-out; 
        }
        input[type="password"] { 
            padding: 15px; 
            border-radius: 30px; 
            border: none; 
            text-align: center; 
            width: 70%; 
            margin-bottom: 20px; 
            outline:none; 
            font-size: 16px; /* Prevents zoom on iPhone */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-login { 
            background: var(--white); color: var(--accent); 
            border: none; padding: 12px 40px; 
            border-radius: 30px; font-weight: bold; 
            cursor: pointer; font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* --- CHAT HEADER --- */
        header { 
            background: var(--white); 
            padding: 15px; 
            display: flex; align-items: center; 
            border-bottom: 1px solid #f0f0f0; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            z-index: 10;
        }
        .header-info { display: flex; flex-direction: column; margin-left: 12px; }
        .status-text { font-size: 0.75rem; color: var(--accent); font-weight: bold; display: none; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* --- CHAT AREA --- */
        .chat-area { 
            flex: 1; 
            padding: 15px; 
            overflow-y: auto; 
            background: #fffafa; 
            display: flex; flex-direction: column; gap: 8px; 
            scroll-behavior: smooth;
        }

        /* --- INPUT AREA --- */
        .input-area { 
            padding: 10px 15px; 
            background: var(--white); 
            display: flex; gap: 10px; 
            border-top: 1px solid #f0f0f0; 
            align-items: center;
        }
        #msg-input { 
            flex: 1; 
            padding: 12px 15px; 
            border: 1px solid var(--secondary); 
            border-radius: 25px; 
            outline: none; 
            font-size: 16px; /* Prevents zoom on iPhone */
            background: #fffcfc;
        }
        button { border: none; background: none; font-size: 1.4rem; cursor: pointer; padding: 0 5px; }
        
        /* --- MESSAGES BUBBLES --- */
        .message-container { display: flex; flex-direction: column; max-width: 80%; }
        .message-container.me { align-self: flex-end; align-items: flex-end; }
        .message-container.friend { align-self: flex-start; align-items: flex-start; }

        .message { 
            padding: 10px 16px; 
            border-radius: 20px; 
            font-size: 0.95rem; 
            line-height: 1.4;
            word-wrap: break-word; 
            position: relative; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .message.me { 
            background: var(--primary); 
            color: var(--white); 
            border-bottom-right-radius: 4px; 
        }
        .message.friend { 
            background: #f0f0f0; 
            color: #333; 
            border-bottom-left-radius: 4px; 
        }
        
        .media-content { 
            max-width: 100%; 
            border-radius: 12px; 
            margin-top: 5px; 
            border: 2px solid rgba(255,255,255,0.5); 
        }
        
        /* TICKS */
        .tick { font-size: 0.65rem; margin-top: 3px; margin-right: 2px; color: rgba(255,255,255,0.7); align-self: flex-end; }
        .tick.blue { color: #e0ffff; font-weight: bold; text-shadow: 0 0 2px rgba(0,0,0,0.1); } /* Light blue for visibility on pink */
    </style>
</head>
<body>

    <div class="app-container">
        <div id="login-screen">
            <h1 style="color:white; margin-bottom: 5px;">üíñ Secret Chat</h1>
            <p style="color:white; opacity:0.8; margin-bottom: 20px;">Besties Only</p>
            <input type="password" id="password" placeholder="Enter Code">
            <button class="btn-login" onclick="checkLogin()">Enter</button>
        </div>

        <header>
            <div style="font-size: 1.8rem;">ü¶Ñ</div>
            <div class="header-info">
                <h3 style="margin:0; color: var(--accent); font-size: 1.1rem;">Bestie</h3>
                <span id="typing-indicator" class="status-text">typing...</span>
            </div>
            <button style="margin-left:auto; font-size:1rem; opacity:0.6;" onclick="clearChat()">üóëÔ∏è</button>
        </header>

        <div class="chat-area" id="chat-box"></div>

        <div class="input-area">
            <input type="file" id="file-input" accept="image/*" style="display:none" onchange="handleFile()">
            <button onclick="document.getElementById('file-input').click()">üì∏</button>
            <input type="text" id="msg-input" placeholder="Message..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">üöÄ</button>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAPI_m98pfb5y6M5twMqL1oKXEpf1o8CCY",
            authDomain: "cute-chat-app-85eed.firebaseapp.com",
            projectId: "cute-chat-app-85eed",
            storageBucket: "cute-chat-app-85eed.firebasestorage.app",
            messagingSenderId: "127608145596",
            appId: "1:127608145596:web:925011780902e048dff2b9",
            databaseURL: "https://cute-chat-app-85eed-default-rtdb.firebaseio.com"
        };

        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (e) { console.error(e); }

        let myId = localStorage.getItem('chat_user_id');
        if (!myId) {
            myId = "user_" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('chat_user_id', myId);
        }

        // 1. LOGIN
        function checkLogin() {
            const pass = document.getElementById('password').value;
            if (pass === "1986") {
                document.getElementById('login-screen').style.top = "-100%";
                initChat();
            } else {
                alert("Wrong password! üö´");
            }
        }

        function initChat() {
            loadMessages();
            setupTypingListener();
        }

        // 2. TYPING
        const msgInput = document.getElementById('msg-input');
        let typingTimeout;

        msgInput.addEventListener('input', () => {
            database.ref('typing/' + myId).set(true);
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                database.ref('typing/' + myId).set(false);
            }, 2000);
        });

        function setupTypingListener() {
            database.ref('typing').on('value', (snapshot) => {
                const data = snapshot.val() || {};
                const indicator = document.getElementById('typing-indicator');
                let someoneElseTyping = false;
                for (let userId in data) {
                    if (userId !== myId && data[userId] === true) {
                        someoneElseTyping = true;
                    }
                }
                indicator.style.display = someoneElseTyping ? 'block' : 'none';
            });
        }

        // 3. SEND
        function sendMessage(imageUrl = null) {
            const text = msgInput.value.trim();
            if (text !== "" || imageUrl) {
                database.ref('chat_room').push({
                    senderId: myId,
                    text: text,
                    image: imageUrl,
                    seen: false,
                    timestamp: Date.now()
                });
                msgInput.value = "";
                database.ref('typing/' + myId).set(false);
            }
        }
        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        // 4. LOAD & SEEN
        function loadMessages() {
            const chatBox = document.getElementById('chat-box');

            database.ref('chat_room').on('child_added', (snapshot) => {
                const msgId = snapshot.key;
                const data = snapshot.val();
                const isMe = data.senderId === myId;

                const container = document.createElement('div');
                container.classList.add('message-container', isMe ? 'me' : 'friend');
                container.id = `msg-${msgId}`;

                const bubble = document.createElement('div');
                bubble.classList.add('message', isMe ? 'me' : 'friend');

                let content = "";
                if(data.image) content += `<img src="${data.image}" class="media-content"><br>`;
                if(data.text) content += `<span>${data.text}</span>`;
                bubble.innerHTML = content;

                container.appendChild(bubble);

                if (isMe) {
                    const tick = document.createElement('span');
                    tick.classList.add('tick');
                    tick.id = `tick-${msgId}`;
                    tick.innerHTML = "‚úì‚úì";
                    if (data.seen) tick.classList.add('blue');
                    container.appendChild(tick);
                }

                chatBox.appendChild(container);
                chatBox.scrollTop = chatBox.scrollHeight;

                if (!isMe && !data.seen) {
                    database.ref('chat_room/' + msgId).update({ seen: true });
                }
            });

            database.ref('chat_room').on('child_changed', (snapshot) => {
                const msgId = snapshot.key;
                const data = snapshot.val();
                if (data.senderId === myId && data.seen) {
                    const tickEl = document.getElementById(`tick-${msgId}`);
                    if (tickEl) tickEl.classList.add('blue');
                }
            });
        }

        // 5. IMAGE & CLEAR
        function handleFile() {
            const file = document.getElementById('file-input').files[0];
            if (file) {
                if(file.size > 2000000) { alert("Image too big!"); return; }
                const reader = new FileReader();
                reader.onload = function(e) { sendMessage(e.target.result); };
                reader.readAsDataURL(file);
            }
        }

        function clearChat() {
            if(confirm("Delete everything?")) {
                database.ref('chat_room').remove();
                document.getElementById('chat-box').innerHTML = "";
            }
        }
    </script>
</body>
</html>
