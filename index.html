<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFF Chat üíñ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* ... (CSS STYLES RETAINED) ... */
        :root {
            --primary: #ffb7b2;
            --secondary: #ffdac1;
            --accent: #ff9aa2;
            --bg: #fff0f5;
            --text: #6e5773;
            --white: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--text); }
        .app-container { width: 100%; max-width: 400px; height: 90vh; background: var(--white); border-radius: 25px; box-shadow: 0 10px 25px rgba(255, 183, 178, 0.5); overflow: hidden; display: flex; flex-direction: column; position: relative; }
        
        /* Login */
        #login-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary), var(--secondary)); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: top 0.5s ease-in-out; }
        input[type="password"] { padding: 12px; border-radius: 20px; border: none; text-align: center; width: 60%; margin-bottom: 15px; }
        .btn-login { background: var(--white); color: var(--accent); border: none; padding: 10px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        
        /* Chat */
        header { background: var(--white); padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #eee; }
        .chat-area { flex: 1; padding: 15px; overflow-y: auto; background: #fffafa; display: flex; flex-direction: column; gap: 10px; }
        .input-area { padding: 10px; background: var(--white); display: flex; gap: 10px; border-top: 1px solid #eee; }
        #msg-input { flex: 1; padding: 10px; border: 1px solid var(--secondary); border-radius: 20px; outline: none; }
        
        /* Messages */
        .message { max-width: 75%; padding: 10px 15px; border-radius: 18px; font-size: 0.95rem; word-wrap: break-word; }
        .message.me { align-self: flex-end; background: var(--primary); color: var(--white); border-bottom-right-radius: 4px; }
        .message.friend { align-self: flex-start; background: #e0e0e0; border-bottom-left-radius: 4px; }
        .media-content { max-width: 100%; border-radius: 10px; margin-top: 5px; }
        button { border: none; background: none; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="app-container">
        <div id="login-screen">
            <h1 style="color:white">üíñ Secret Chat</h1>
            <input type="password" id="password" placeholder="Password">
            <button class="btn-login" onclick="checkLogin()">Enter</button>
            <p id="status" style="color:white; font-size:0.8rem; margin-top:10px;"></p>
        </div>

        <header>
            <h3 style="margin:0; color: var(--accent);">Us ü¶Ñ</h3>
            <button style="margin-left:auto; font-size:0.8rem;" onclick="clearChat()">üóëÔ∏è</button>
        </header>

        <div class="chat-area" id="chat-box"></div>

        <div class="input-area">
            <input type="file" id="file-input" accept="image/*" style="display:none" onchange="handleFile()">
            <button onclick="document.getElementById('file-input').click()">üì∏</button>
            <input type="text" id="msg-input" placeholder="Say something..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">üöÄ</button>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // ‚úÖ YOUR CORRECTED FIREBASE CONFIGURATION (V8/Compatibility format)
        // This is the configuration pasted from your Firebase console, 
        // adapted for the simpler v8 initialization used in the functions below.
        // I have added the databaseURL which is essential for the Realtime Database to work!
        // -----------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyCwziosDAtYpIO0ifve0uNPDyES4ucRJCE",
            authDomain: "cute-chat-8da2c.firebaseapp.com",
            projectId: "cute-chat-8da2c",
            storageBucket: "cute-chat-8da2c.firebasestorage.app",
            messagingSenderId: "253976623024",
            appId: "1:253976623024:web:969f4cc45a320779bf8875",
            // You MUST manually add the databaseURL for the Realtime Database:
            databaseURL: "https://cute-chat-8da2c-default-rtdb.firebaseio.com" 
        };
        // -----------------------------------------------------------


        // Initialize Firebase
        let database;
        try {
            // This initializes the app using the configuration above
            firebase.initializeApp(firebaseConfig);
            // This sets the database reference needed for the chat functions
            database = firebase.database();
        } catch (e) {
            console.error("Firebase Initialization Error:", e);
            alert("Error: Firebase could not connect. Check your internet or configuration.");
        }

        // 1. LOGIN
        const myId = "user_" + Math.random().toString(36).substr(2, 9); // Random ID for you

        function checkLogin() {
            const pass = document.getElementById('password').value;
            if (pass === "1986") {
                // Check if firebase is valid
                if (!database) {
                    alert("Error: Database connection failed. Please check your config keys.");
                    return;
                }
                document.getElementById('login-screen').style.top = "-100%";
                loadMessages();
            } else {
                alert("Wrong password! üö´");
            }
        }

        // 2. SENDING MESSAGES
        function sendMessage(imageUrl = null) {
            const input = document.getElementById('msg-input');
            const text = input.value.trim();

            if (text !== "" || imageUrl) {
                const msgData = {
                    senderId: myId,
                    text: text,
                    image: imageUrl,
                    timestamp: Date.now()
                };

                // Send to Firebase Cloud
                database.ref('chat_room').push(msgData);
                input.value = "";
            }
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        // 3. RECEIVING MESSAGES (Real-time Listener)
        function loadMessages() {
            const chatBox = document.getElementById('chat-box');
            
            // Whenever a new message is added to Firebase database
            database.ref('chat_room').on('child_added', (snapshot) => {
                const data = snapshot.val();
                const isMe = data.senderId === myId;
                
                const div = document.createElement('div');
                div.classList.add('message', isMe ? 'me' : 'friend');
                
                let content = "";
                if(data.image) {
                    content += `<img src="${data.image}" class="media-content"><br>`;
                }
                if(data.text) {
                    content += `<span>${data.text}</span>`;
                }
                
                div.innerHTML = content;
                chatBox.appendChild(div);
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        // 4. IMAGE HANDLING (Base64 Encoding for simplicity)
        function handleFile() {
            const file = document.getElementById('file-input').files[0];
            if (file) {
                // Simple limit: prevent giant files crashing the browser
                if(file.size > 1000000) { alert("Image too big! Please use a smaller image."); return; }

                const reader = new FileReader();
                reader.onload = function(e) {
                    sendMessage(e.target.result); // Send the image data string
                };
                reader.readAsDataURL(file);
            }
        }

        // 5. CLEAR CHAT (Optional)
        function clearChat() {
            if(confirm("Delete all messages for everyone?")) {
                database.ref('chat_room').remove();
                document.getElementById('chat-box').innerHTML = "";
            }
        }
    </script>
</body>
</html>
